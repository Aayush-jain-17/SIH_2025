<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HydroBots | Rainfall Forecast</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    
  canvas {
    display: block;
    margin: 0 auto;                 
    background: #fff;
    padding: 0.5rem;
    border-radius: var(--radius);
    width: 100% !important;          /* make it take full width */
    max-width: 650px;                /* prevent it from stretching too wide */
    height: 400px !important;        /* fixed bigger height */
  }
    :root {
      --primary-color: #2D6A6B;
      --secondary-color: #5AA1A3;
      --light-bg-color: #D3E0E2;
      --dark-bg-color: #1A3E3F;
      --card: #ffffff;
      --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      --radius: 12px;
      --container: 1200px;
    }

    body {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      background: var(--light-bg-color);
      color: #333;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      text-align: center;
    }

    /* HEADER */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--primary-color);
      padding: 1rem 2rem;
      color: white;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo-img {
      width: 46px;
      height: 46px;
      object-fit: contain;
    }

    .logo h2 {
      font-size: 1.6rem;
      font-weight: 700;
      color: #fff;
      margin: 0;
    }

    .navbar a {
      margin: 0 1rem;
      text-decoration: none;
      color: white;
      font-weight: 500;
    }

    .navbar a.active {
      border-bottom: 2px solid white;
    }

    /* MAIN CONTENT */
    .container {
      display: inline-block;
      margin: 2rem auto;
      background: var(--card);
      padding: 2rem;                  /* extra padding */
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      text-align: center;
      width: calc(100% + 96px);       /* increase width by ~1 inch */
      max-width: 700px;               /* prevent box from being too wide */
    }

    .container > *:not(:last-child) {
      margin-bottom: 20px;            /* vertical spacing between elements */
    }

    h1 {
      color: var(--dark-bg-color);
    }

    p {
      color: #555;
    }

    .input-group {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;                      /* more space between input and button */
    }

    .input-group input,
    .input-group button {
      width: 60%;
      max-width: 300px;
      padding: 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 1rem;
    }

    .input-group button {
      background: var(--primary-color);
      color: white;
      border: none;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    .input-group button:hover {
      background: var(--secondary-color);
    }

    canvas {
      display: block;
      margin: 0 auto;                 /* center chart */
      background: #fff;
      padding: 0.5rem;
      border-radius: var(--radius);
      max-width: 100%;
    }

    @media (max-width: 768px) {
      .header {
        flex-direction: column;
        text-align: center;
      }
      .navbar {
        margin-top: 1rem;
      }
      .input-group input,
      .input-group button {
        width: 100%;
      }
      .container {
        width: 95%;                   /* make it responsive on small screens */
      }
    }
  </style>
</head>
<body>
  <!-- HEADER -->
  <header class="header">
    <div class="logo">
      <img src="logo.png" alt="HydroBots Logo" class="logo-img">
      <h2>HydroBots</h2>
    </div>
    <nav class="navbar">
      <a href="index.html">Home</a>
      <a href="dashboard.html">Dashboard</a>
      <a href="calculate.html">Calculate</a>
      <a href="add-property.html">Add Property</a>
      <a href="rainfall.html" class="active">Fetch Rainfall</a>
    </nav>
  </header>

  <!-- MAIN CONTENT -->
  <div class="container">
    <h1>üåßÔ∏è Rainfall Forecast</h1>
    <p>Enter a city to see the next 5 days rainfall trend</p>

    <div class="input-group">
      <input type="text" id="cityInput" placeholder="Enter city (e.g. Indore)">
      <button onclick="fetchRainfall()">Get Forecast</button>
    </div>

    <canvas id="rainChart"></canvas>
  </div>

  <script>
    const apiKey = "e6f0c0dee5db64fdc0ddcb5e5162b198"; // replace with your OpenWeatherMap API key
    let rainChart = null;

    async function fetchRainfall() {
      const city = document.getElementById("cityInput").value.trim();
      if (!city) {
        alert("Please enter a city name.");
        return;
      }

      const url = `https://api.openweathermap.org/data/2.5/forecast?q=${city}&appid=${apiKey}&units=metric`;

      try {
        const response = await fetch(url);
        const data = await response.json();

        if (data.cod !== "200") {
          alert("City not found! Try again.");
          return;
        }

        // Extract rainfall data
        const rainfallData = data.list.map(entry => ({
          time: entry.dt_txt,
          rainfall: entry.rain ? entry.rain["3h"] || 0 : 0
        }));

        const labels = rainfallData.map(r => r.time);
        const values = rainfallData.map(r => r.rainfall);

        if (rainChart) {
          rainChart.destroy();
        }

        const ctx = document.getElementById("rainChart").getContext("2d");
        rainChart = new Chart(ctx, {
          type: "bar",
          data: {
            labels: labels,
            datasets: [{
              label: "Rainfall (mm per 3h)",
              data: values,
              backgroundColor: "rgba(45, 106, 107, 0.6)",
              borderColor: "rgba(45, 106, 107, 1)",
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            plugins: { legend: { display: false } },
            scales: {
              x: {
                ticks: { maxRotation: 90, minRotation: 45 }
              },
              y: {
                beginAtZero: true,
                title: { display: true, text: "Rainfall (mm)" }
              }
            }
          }
        });

      } catch (error) {
        console.error("Error fetching forecast:", error);
        alert("Something went wrong! Please try again.");
      }
    }
  </script>
</body>
</html>
